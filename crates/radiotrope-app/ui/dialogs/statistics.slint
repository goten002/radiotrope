import { Theme } from "../theme.slint";

component StatRow inherits Rectangle {
    in property <string> label;
    in property <string> value;

    height: 20px;

    HorizontalLayout {
        Text {
            width: 90px;
            text: root.label;
            color: Theme.text-secondary;
            font-size: 11px;
            vertical-alignment: center;
        }

        Text {
            text: root.value;
            color: Theme.text-primary;
            font-size: 11px;
            vertical-alignment: center;
            horizontal-stretch: 1;
        }
    }
}

component SectionHeader inherits Rectangle {
    in property <string> title;

    height: 24px;

    HorizontalLayout {
        padding-top: 6px;

        Text {
            text: root.title;
            color: Theme.accent-text;
            font-size: 10px;
            font-weight: 600;
            letter-spacing: 1px;
            vertical-alignment: center;
        }
    }
}

export component StatisticsDialog inherits Rectangle {
    in-out property <bool> show-dialog: false;

    in property <string> stat-health: "--";
    in property <string> stat-uptime: "--";
    in property <string> stat-codec: "--";
    in property <string> stat-bitrate: "--";
    in property <string> stat-sample-rate: "--";
    in property <string> stat-channels: "--";
    in property <string> stat-received: "--";
    in property <string> stat-throughput: "--";
    in property <string> stat-buffer-level: "--";
    in property <string> stat-buffer-capacity: "--";
    in property <string> stat-frames-played: "--";
    in property <string> stat-decode-errors: "--";
    in property <string> stat-underruns: "--";

    if show-dialog: Rectangle {
        width: 100%;
        height: 100%;
        background: #000000aa;

        TouchArea {
            clicked => {
                root.show-dialog = false;
            }
        }

        Rectangle {
            x: (parent.width - self.width) / 2;
            y: (parent.height - self.height) / 2;
            width: 480px;
            height: card-layout.preferred-height + 24px;
            background: Theme.panel;
            border-radius: 8px;
            drop-shadow-blur: 16px;
            drop-shadow-color: #00000080;

            TouchArea {}

            card-layout := VerticalLayout {
                padding: 16px;
                spacing: 0;

                // Title bar with close button
                HorizontalLayout {
                    height: 28px;

                    Text {
                        text: "Statistics";
                        color: Theme.text-primary;
                        font-size: 14px;
                        font-weight: 600;
                        vertical-alignment: center;
                        horizontal-stretch: 1;
                    }

                    Rectangle {
                        width: 24px;
                        height: 24px;
                        border-radius: 4px;
                        background: close-touch.has-hover ? Theme.menu-hover : transparent;

                        close-touch := TouchArea {
                            clicked => { root.show-dialog = false; }
                        }

                        Image {
                            width: 12px;
                            height: 12px;
                            source: @image-url("../icons/xmark.svg");
                            colorize: close-touch.has-hover ? white : Theme.text-secondary;
                        }
                    }
                }

                // Two-column layout
                HorizontalLayout {
                    spacing: 16px;

                    // Left column: Stream + Codec
                    VerticalLayout {
                        width: 216px;
                        spacing: 0;

                        SectionHeader { title: "STREAM"; }
                        StatRow { label: "Health"; value: root.stat-health; }
                        StatRow { label: "Uptime"; value: root.stat-uptime; }

                        SectionHeader { title: "CODEC"; }
                        StatRow { label: "Codec"; value: root.stat-codec; }
                        StatRow { label: "Bitrate"; value: root.stat-bitrate; }
                        StatRow { label: "Sample Rate"; value: root.stat-sample-rate; }
                        StatRow { label: "Channels"; value: root.stat-channels; }
                    }

                    // Right column: Network + Buffer + Decode
                    VerticalLayout {
                        width: 216px;
                        spacing: 0;

                        SectionHeader { title: "NETWORK"; }
                        StatRow { label: "Received"; value: root.stat-received; }
                        StatRow { label: "Throughput"; value: root.stat-throughput; }

                        SectionHeader { title: "BUFFER"; }
                        StatRow { label: "Level"; value: root.stat-buffer-level; }
                        StatRow { label: "Capacity"; value: root.stat-buffer-capacity; }
                        SectionHeader { title: "DECODE"; }
                        StatRow { label: "Frames"; value: root.stat-frames-played; }
                        StatRow { label: "Errors"; value: root.stat-decode-errors; }
                        StatRow { label: "Underruns"; value: root.stat-underruns; }
                    }
                }
            }
        }
    }
}
